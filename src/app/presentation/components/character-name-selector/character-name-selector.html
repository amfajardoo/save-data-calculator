<div class="relative flex-1">
  <button
    (click)="toggleOpen()"
    class="flex items-center gap-2 bg-transparent border-none text-lg font-bold focus:outline-none focus:ring-1 focus:ring-purple-400 rounded px-1 py-0.5 w-full text-left text-white transition hover:bg-white/10"
  >
    <img
      [src]="currentImageUrl()"
      [alt]="currentName()"
      class="w-6 h-6 rounded-full object-cover shrink-0"
    />
    <span class="truncate flex-1">{{ currentName() }}</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="12"
      height="12"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="transition-transform shrink-0"
      [class.rotate-180]="isOpen()"
    >
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </button>

  @if (isOpen()) {
    <div
      class="absolute left-0 right-0 mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-2xl z-20 w-fit max-h-100 overflow-y-auto custom-scrollbar"
    >
      <input
        type="text"
        placeholder="Buscar..."
        [value]="search()"
        (input)="handleSearch($event)"
        class="search-input w-full p-2 text-lg bg-slate-700 text-white border-b border-slate-600 rounded-t-lg focus:outline-none"
      />

      @for (char of filteredCharacters(); track char.slug) {
        <div
          class="character-option flex items-center gap-2 p-2 cursor-pointer hover:bg-indigo-700 transition"
          (click)="selectCharacter(char)"
        >
          <img
            [src]="char.imageUrl"
            [alt]="char.name"
            class="character-option-avatar w-8 h-8 rounded-full object-cover shrink-0"
          />
          <span class="character-option-name text-lg font-medium text-white">{{ char.name }}</span>
        </div>
      } @empty {
        <div class="p-2 text-base text-slate-400 text-center">No se encontraron resultados.</div>
      }
    </div>
  }
</div>
